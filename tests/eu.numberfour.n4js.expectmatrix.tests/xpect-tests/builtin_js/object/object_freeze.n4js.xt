/* XPECT_SETUP eu.numberfour.n4js.expectmatrix.tests.N4JSExpectMatrixPendingTest 
   
    ResourceSet {
		ThisFile { }
		Resource "error_helper.n4js" { }
	}
   
   END_SETUP
 */
 
import { getNodeJs5xErrorToString } from "builtin_js/object/error_helper"

// Object.freeze()
// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze

var obj : Object+ = {
  prop: function (){},
  foo: "bar"
};

// New properties may be added, existing properties may be changed or removed
obj.foo = "baz";
obj.lumpy = "woof";
delete obj.prop;

// IDEBUG-126 XPECT noerrors --> "IDEBUG-126: wrong return value"
var o = Object.freeze(obj);
console.log("returned: " + JSON.stringify(o));

console.log("frozen = " + (Object.isFrozen(obj) === true));

// Now any changes will fail (note: N4JS is now always in strict mode)
try { obj.foo = "quux"; } catch(e) { console.log(getNodeJs5xErrorToString(e)); }
try { obj.quaxxor = "the friendly duck"; } catch(e) { console.log(getNodeJs5xErrorToString(e)); }

console.log("unchanged: " + JSON.stringify(obj));

// ...and in strict mode such attempts will throw TypeErrors
function fail(){
  "use strict";
  try { 
  	obj.foo = "sparky"; // throws a TypeError
  }
  catch (e) { console.log(getNodeJs5xErrorToString(e)); }
  
  try {
  	obj.sparky = "arf"; // throws a TypeError
  }
  catch (e1) { console.log(getNodeJs5xErrorToString(e1)); }
}

// Attempted changes through Object.defineProperty will also throw TypeError
function attemptChanges() {
	try {
		Object.defineProperty(obj, "ohai", { value: 17 }); // throws a TypeError
	}
	catch (e) { console.log(getNodeJs5xErrorToString(e));
	}
	try {
		Object.defineProperty(obj, "foo", { value: "eit" }); // throws a TypeError
	}
	catch (e1) { console.log(getNodeJs5xErrorToString(e1));}
	}
	
fail();
attemptChanges();

/* XPECT output --- 
<==
stdout:
returned: {"foo":"baz","lumpy":"woof"}
frozen = true
[TypeError: Cannot assign to read only property 'foo' of object '#<Object>']
[TypeError: Can't add property quaxxor, object is not extensible]
unchanged: {"foo":"baz","lumpy":"woof"}
[TypeError: Cannot assign to read only property 'foo' of object '#<Object>']
[TypeError: Can't add property sparky, object is not extensible]
[TypeError: Cannot define property:ohai, object is not extensible.]
[TypeError: Cannot redefine property: foo]
stderr:
==>
--- */
